<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.css" rel="stylesheet" />
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/iconfont.css">
		<link rel="stylesheet" href="css/mui.picker.css">
		<link rel="stylesheet" href="css/mui.poppicker.css">
		<link rel="stylesheet" href="css/mui.dtpicker.css">
		<style type="text/css">
			.mui-bar-nav {
				background: #04B1E9;
			}

			.mui-bar-nav a,
			.mui-bar-nav h1 {
				color: #fff;
			}

			.ui-alert {
				text-align: center;
				padding: 20px 10px;
				font-size: 16px;
			}

			.icon-rili {
				float: right;
				width: 15%;
				line-height: 1.1;
				padding: 7px 10px 7px 0px;
				color: #007aff;
			}

			.icon-renwu {
				float: left;
				line-height: 1.1;
				padding: 7px 10px 7px 0px;
				color: #007aff;
			}

			.icon-fujian {
				float: left;
				line-height: 1.1;
				padding: 7px 10px 7px 0px;
				color: #007aff;
			}

			#popover {
				height: 100px;
				width: 200px;
			}

			.mui-badge1 {
				padding: 0px;
				width: 65%;
				float: right;
				line-height: 42px;
				font-size: 14px;
			}
			
			/*toast信息提示*/
			.mui-toast-container {
				bottom: 50% !important;
			}

			.mui-toast-message {
				font-size: 1.5rem;
				opacity: 0.6;
				color: #fff;
				width: auto;
				padding: 20px 20px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">电子记录单</h1>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded" style="margin: 5px;">
				<form id="form" class="mui-input-group" enctype="multipart/form-data">
					<div class="mui-input-row">
						<label>编号：</label>
						<input id="number" type="text" placeholder="系统自动生成编号" readonly="readonly">
					</div>
					<div class="mui-input-row">
						<label>名称：</label>
						<input id="name" type="text" class="mui-input-clear" placeholder="请输入电子记录名称">
					</div>
					<div class="mui-input-row">
						<label>站点名称：</label>
						<input id="stationName" type="text" class="mui-input-clear" placeholder="">
					</div>
					<div class="mui-input-row">
						<label>事项类别：</label>
						<a class="mui-navigate-right">
							<span class="mui-badge1">
								<select id="itemCategory" name="itemCategory" class="mui-h5" style="margin:auto; color:#000;">
									<option value="1" selected ="selected">日常记录</option>
									<option value="2">交接班记录</option>
									<option value="3">设备故障</option>
									<option value="4">加氢站启动/停止</option>
									<option value="5">事件报告</option>
									<option value="6">通知</option>
								</select>
							</span>
						</a>
					</div>
					<div class="mui-input-row">
						<label>记录时间：</label>
						<input id="iRecordingTime" style="width: 50%; float: left; padding: 11px 0px;" placeholder="1969-01-01" /><span
						 id="recordingTime" class="mui-icon iconfont icon-rili"></span>
					</div>
					<div class="mui-input-row">
						<label>记录者：</label>
						<span class="mui-icon iconfont icon-renwu"></span>
						<input id="recorder" style="width: 50%; float: left; padding: 11px 0px;" />
					</div>
					<div class="mui-input-row">
						<label>设备类型：</label>
						<a class="mui-navigate-right">
							<span class="mui-badge1">
								<select id="equipmentType" name="equipmentType" class="mui-h5" style="margin:auto; color:#000;">
									<option value="1" selected ="selected">机械</option>
									<option value="2">仪控</option>
									<option value="3">电气</option>
									<option value="4">安全</option>
									<option value="5">其他</option>
								</select>
							</span>
						</a>
					</div>
					<div class="mui-input-row">
						<label>等级：</label>
					</div>
					<div style="background-color: #eee;padding-left: 1rem;">
						<div class="mui-input-row mui-radio mui-left">
							<label>P1（高严重程度）</label>
							<input name="grade" type="radio" value="P1" checked class="radio">
						</div>
						<div class="mui-input-row mui-radio mui-left">
							<label>P2（中等严重程度）</label>
							<input name="grade" type="radio" value="P2" class="radio">
						</div>
						<div class="mui-input-row mui-radio mui-left">
							<label>P3（一般严重程度）</label>
							<input name="grade" type="radio" value="P3" class="radio">
						</div>
						<div class="mui-input-row mui-radio mui-left">
							<label>P4（轻微）</label>
							<input name="grade" type="radio" value="P4" class="radio">
						</div>
					</div>
					<div class="mui-input-row">
						<label>情况描述：</label>
					</div>
					<textarea id="description" rows="5" placeholder="用几句话来描述你的问题"></textarea>
					<div class="mui-button-row">
						<button id="submit_btn" type="button" class="mui-btn mui-btn-primary" style="width: 30%; padding: 5px 0; margin-right: 10%;">确认</button>
						<button id="cancel_btn" type="button" class="mui-btn mui-btn-danger" style="width: 30%; padding: 5px 0;">取消</button>
					</div>
				</form>
			</div>
		</div>
		<script src="js/mui.js"></script>
		<script src="js/mui.picker.js"></script>
		<script src="js/mui.poppicker.js"></script>
		<script src="js/mui.dtpicker.js"></script>
		<script src="js/jquery.min.js" type="text/javascript"></script>
		<script>
			mui.init();
			var time = new Date();
			var iRecordingTime = document.getElementById("iRecordingTime");
			var year = time.getFullYear();
			var month = time.getMonth()+1;
			if (month < 10) {
				month = '0' + month;
			}
			var day = time.getDate();
			if (day < 10) {
				day = '0' + day;
			}
			iRecordingTime.value = year + '-' + month + '-' + day;
			var timestamp = new Date().getTime();
			var number = document.getElementById("number");
			number.value = 'DZ' + timestamp;
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();
				var stationId = self.stationId;
				var stationName = self.stationName;
				mui.back = function() {
					if ($("#submit_btn").prop("disabled")) {
						mui.currentWebview.close();
					} else {
						mui.confirm('您还没提交，是否提交？', ' ', ['终止提交', '继续操作'], function(e) {
							if (e.index == 0) {
								mui.currentWebview.close();
							}
							/* if (e.index == 1) {
								addData();
							} */
						}, 'div')
					}
				}
				// 滑动触发input失去焦点
				document.querySelector('.mui-content').addEventListener('swipe', function() {
					var input = document.getElementsByTagName("input");
					for (let i = 0; i < input.length; i++) {
						input[i].blur();
					}
				})
				// 滑动触发textarea失去焦点
				document.querySelector('.mui-content').addEventListener('swipe', function() {
					var textarea = document.getElementsByTagName("textarea");
					for (let i = 0; i < textarea.length; i++) {
						textarea[i].blur();
					}
				})
				$('#stationName').prop("disabled", true);
				$("#stationName").val(stationName);
				$('#recorder').prop("disabled", true);
				$("#recorder").val(plus.storage.getItem('username'));

				//记录时间
				$('#iRecordingTime').prop("disabled", true);
				var Date1 = new mui.DtPicker({
					type: 'datetime'
				});
				var iRecordingTime = document.getElementById("iRecordingTime");
				var recordingTime = document.getElementById("recordingTime");
				recordingTime.addEventListener('tap', function() {
					Date1.show(function(item) {
						//日期和日期时间改变一下type值就行 
						iRecordingTime.value = item.toString();
					})
				});
				var submit_btn = document.getElementById("submit_btn");
				var cancel_btn = document.getElementById("cancel_btn");
				submit_btn.addEventListener('tap', function() {
					addData();
				});

				cancel_btn.addEventListener('tap', function() {
					if ($("#submit_btn").prop("disabled")) {
						mui.currentWebview.close();
					} else {
						mui.confirm('您还没提交，是否提交？', ' ', ['终止提交', '继续操作'], function(e) {
							if (e.index == 0) {
								mui.currentWebview.close();
							}
						}, 'div')
					}
				});
				function addData() {
					var userId = plus.storage.getItem('userId');
					var number = $("#number").val();
					var name = $("#name").val();
					var itemCategory = $('#itemCategory option:selected').val();
					var iRecordingTime = $("#iRecordingTime").val();
					var equipmentType = $('#equipmentType option:selected').val();
					var grade = $('input[name="grade"]:checked').val();
					var description = $("#description").val();
					data = {
						userId: userId,
						number: number,
						name: name,
						stationId: stationId,
						itemCategory: itemCategory,
						iRecordingTime: iRecordingTime,
						equipmentType: equipmentType,
						grade: grade,
						description: description
					}
					mui.ajax('http://www.hyfuncloud.cn/api/electronicRecord/add', {
						data: data,
						dataType: "json",
						type: 'post',
						async: false,
						timeout: 10000,
						success: function(result) {
							if (result.data == "提交成功") {
								submit_btn.setAttribute("disabled", true);
								mui.toast('提交成功', {
									duration: 'short',
									type: 'div'
								});
							} else {
								mui.toast('JSON.stringify(result.data)', {
									duration: 'short',
									type: 'div'
								});
							}
						},
						error: function(xhr, type, errorThrown) {
							mui.toast('错误', {
								duration: 'short',
								type: 'div'
							});
						}
					})
				}
			})
		</script>
	</body>

</html>
